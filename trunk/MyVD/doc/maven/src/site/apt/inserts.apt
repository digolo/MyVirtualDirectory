 -----
 MyVD LDAP Virtual Directory
 -----
 The MyVD Team
 -----

Insert Reference

 This guide desibribes how existing inserts work, are configured and any external dependencies they may have.  

* Access Controls

 The access controls for MyVD are based on a draft RFC.  The RFC can be read [[www.cnn.com] here].  The access control system utilizes a list of access control items.  Each item is structured as:

** Configuring The Access Control Insert

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.ldap.LDAPInterceptor      |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Search,Compare,Bind,Add,Modify,Delete,Rename           |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|numACIs                                                | The number of ACIs to be processed   |
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |aci.X                                                  | An ACI to process based on the below configuration.  "X" is the number of the ACI and should begin with 0.  |
*---------------------+-------------------------------------------------------+--------------------------------------+

** Speifying an ACI 

+--------------+
scope-base#scope#grant/deny:permisions#scope#users
+--------------+
 
 The below table explains each part of the ACI:
 
*-------------+----------------------------+----------------------------------------+
|Component    |Description                 |Example                                 |
*-------------+----------------------------+----------------------------------------+
|scope-domain |The base of the scope this ACI applies to.  This ACI will only be considered for operations that are subordinates of this DN|ou=people,dc=domain,dc=com|
*-------------+----------------------------+----------------------------------------+
|scope        |The scope of this ACI.  The scope can either be "subtree" to apply to all subordinates of the scope-base or "entry" to apply only to the scope-domain.|subtree OR entry|
*-------------+----------------------------+----------------------------------------+
|grant/deny   |Determines if the outcome of this ACI should result in a grant or deny|grant OR deny|
*-------------+----------------------------+----------------------------------------+
|permisions   |Which permisions this ACI grants or denys. See the below table for a list of permisions|
*-------------+----------------------------+----------------------------------------+
|scope        |Whether this applies to entry results or attributes. The below table explains the different options|[entry] OR [all] OR a comma sepperated list of attribute names|
*-------------+----------------------------+----------------------------------------+
|users        |Which users this ACI applies to.  The below table lists the possible values for this option|See the below table|
*-------------+----------------------------+----------------------------------------+

*** Entry Permisions

*--------------------+------------------+---------------------+
|Permision           |Letter            |Description          |
*--------------------+------------------+---------------------+
|Create              |c                 |Determines if entries may be created|
*--------------------+------------------+---------------------+
|Delete              |d                 |Determines if the entry may be deleted|
*--------------------+------------------+---------------------+
|View                |v                 |Determines if the entry may be viewed|
*--------------------+------------------+---------------------+
|Rename              |n                 |Determines if the entry can be renamed|
*--------------------+------------------+---------------------+

*** Attribute Permisions

*--------------------+------------------+---------------------+
|Permision           |Letter            |Description          |
*--------------------+------------------+---------------------+
|Read                |r                 |Determines if the attribute can be read|
*--------------------+------------------+---------------------+
|Write               |w                 |Determines if the attribute can be written to|
*--------------------+------------------+---------------------+
|Obliterate          |o                 |Determines if the attribute can be removed from the entry|
*--------------------+------------------+---------------------+
|Search              |s                 |Determines if the attribute can be included in a search filter|
*--------------------+------------------+---------------------+
|Compare             |c                 |Determines if the attribute can be included in a compare operation|
*--------------------+------------------+---------------------+
|Presence Search     |p                 |Determines if a filter on the presence of the attribute in the entry|
*--------------------+------------------+---------------------+



*** Users Options

*------------------+--------------------+--------------------+-------------------------+
|Users Option      |Description         |Syntax              |Example                  |
*------------------+--------------------+--------------------+-------------------------+
|Sub Tree          |This ACI applies to all users beneath the given DN|subtree:DN|subtree:ou=users,dc=domain,dc=com|
*------------------+--------------------+--------------------+--------------------------+
|DN                |This ACI applies to the specified DN only|dn:DN|dn:cn=admin,ou=admins,dc=domain,dc=com|
*------------------+--------------------+--------------------+--------------------------+
|This              |The ACI applies to the currently bound user.  This is useful for permisions such as letting a user rest their own password|this:|
*------------------+--------------------+--------------------+--------------------------+
|Group             |An LDAP static group is used to apply this ACI|group:DN_OF_GROUP|group:cn=admins,ou=groups,dc=domain,dc=com|
*------------------+--------------------+--------------------+--------------------------+
|Dynamic Group     |An LDAP dynamic group is used to apply this ACI|dynamic-group:DN_OF_DYNAMIC_GROUP|dynamic-group:cn=admins,ou=groups,dc=domain,dc=com|
*------------------+--------------------+--------------------+--------------------------+
|Public            |This ACI applies to all users, bound an anonymouse|
*------------------+--------------------+--------------------+--------------------------+

* Attribute Cleaner

 This insert ensures that the attributes requested by a search request are the only attributes returned to the user.  This insert is usefull when additional attributes are added to an entry for meta data purposes but should not be returned to the user.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.mapping.AttributeCleaner  |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Search                                                 |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|None                                                   |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+

* Attribute Mapper

 The attribute mapper insert is used to map the names of attributes.  For instance it could map uid to samaccountname.  This insert works on attribute names in both entries, dns and filters.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.mapping.AttributeMapper   |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Search,Add,Modify,Delete,Compare,Rename                |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|mapping                                                | Comma seperated list of attribute maps.  For instance "uid=samaccountname"                                     |
*---------------------+-------------------------------------------------------+--------------------------------------+



* Attribute Value Mapper

 The attribute value mapper is used to map one entry value to another.  For instance mapping "objectClass: inetOrgPerson" -> "objectClass: user".

*---------------------+---------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.mapping.AttributeValueMapper|                                      |
*---------------------+---------------------------------------------------------+--------------------------------------+
|Scope                |Search,Add,Modify,Compare                                |                                      |
*---------------------+---------------------------------------------------------+--------------------------------------+
|Configuration Options|mapping                                                  |Comma sepperated list of mappings in the form of "attribute.curvalue=newvalue".  For instance "objectClass.inetOrgPerson=user                                      |
*---------------------+---------------------------------------------------------+--------------------------------------+

* Create SPML Identity

 The SPML identity insert is designed to create an LDAP compliant DN for use with the LDAP insert in SPML mode.  SPML does not require a full DN as a name (it can for instance use a userid or an email address), but LDAP does.  This insert ensures that the DN  for the user object has the correct RDN for SPML while being LDAP compliant.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.idm.CreateSPMLIdentity    |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Add, Modify, Delete                                    |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|type                                                   |The SPML identity type (ie GenericString                                   |
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |attribute                                              |The attribute that will act as the source for the RDN data|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |keepNameAsAttribute                                    |true or false if the rdn's attribute will remain on the user object|
*---------------------+-------------------------------------------------------+--------------------------------------+


* DB Groups

 This insert is used when groups stored in a relational database are stored with a name and not a full DN.  This plugin will create the DN to make it LDAP compliant.


*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.jdbc.DBGroups             |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Search                                                 |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|memberAttribute                                        |The name of the attribute that represents members (ie uniqueMember)                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |suffix                                                 |The member suffix (ie ou=groups,dc=domain,dc=com|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |rdn                                                    |The name of the rdn attribute (ie uid)|
*---------------------+-------------------------------------------------------+--------------------------------------+


* DumpTransaction

 This insert dumps the details of a request to the log.  DumpTransaction is very usefull when debugging a MyVD deployment. By placing this insert at various points in the server it's possible to see how requests and responses are effected.  Note that this insert can have an adverse effect on performance. 

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.DumpTransaction           |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |All                                                    |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|logLevel                                               |One of info,debug,error,warn          |
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |label                                                  |A label to describe this DumpTransaction insert in the logs|
*---------------------+-------------------------------------------------------+--------------------------------------+


* Flatten Namespace
 
 This insert removes components from an LDAP DN and can optionally store them in the user entry.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.idm.FlattenNamespace      |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Add, Delete                                                 |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|attribsToRemove                                        |Comma sepperated list of attributes to remove from the DN           |
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |	attributesToStore                                     |Comma sepperated list of attributes in the DN to store in the user entry|
*---------------------+-------------------------------------------------------+--------------------------------------+


* JDBC Insert

 The JDBC insert is used to expose a relational database through MyVD.  This insert only supports a single objectClass and rdn for each configuration of the insert.  

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.jdbc.JdbcInterceptor      |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Search                                               |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|driver|The JDBC driver to use|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |url|The JDBC connection URL|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |user|The database user to connect as|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |password|The password to connect with|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |rdn|The LDAP atribute used as the rdn for all objects generated|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |mapping|Comma sepperated list of ldap=db mapping of attributes|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |objectClass|The objectClass for all octs created by this insert|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |sql|The SQL use to determine what objects this insert will generate.  This SQL must include all attributes included in the mapping configuration|
*---------------------+-------------------------------------------------------+--------------------------------------+ 

* Joiner

 The joiner is used to combine two LDAP namespaces (note that this means two DN namespace, not two configuration namespaces). The joiner combines entries from each namespace.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.join.Joiner               |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Search                                                 |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|primaryNamespace|LDAP DN that represents a configured namespace that will drive the namespace of the joiner|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |joinedNamespace|LDAP DN that represents a configured namespace that will be joined with the primaryNamespace.  The namespace of the primaryNamespace drives the joiner's namespace|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |joinedAttributes|Attributes to be included in the join|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |joinFilter|A filter that is used to combine objects.  When including an attribute from the joining entry prepend the attribute with "ATTR.".  For instance, to combine a user based on the uid attribute the filter would be "(uid=ATTR.uid)"|
*---------------------+-------------------------------------------------------+--------------------------------------+


* Kerberos Authenticator

 The kerberos authenticator can be used to authenticate users via the Kerberos protocol, such as against LDAP.  Note that all configuration is based on the Java JNDI kerberos authentication file. (need to add a link)

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.kerberos.KerberosInterceptor
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Bind                                                   |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|None                                                   |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+

* LDAP Insert

 The LDAP insert is one of the core inserts.  This insert allows MyVD to communicate with any LDAPv3 compliant directory.  In addtion to LDAP directories, this isnert supports DSMLv2 and SPML.  In order to take advantage of the SPML feautures you must download the OpenSPML toolkit (http://www.openspml.org/) and it's dependencies.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.kerberos.KerberosInterceptor|                                    |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Add, Modify, Rename, Delete, Compare, Search, Bind, Extended Operiations|                     |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|host|The host of the remote server.  If this insert is using DSMLV2 or SPML then this is the URL of the end point.                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |port|The port the remote ldap server is listening on.  Ignored for DSMLV2 and SPML|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |remoteBase|The base of the remote LDAP server that the insert would start at|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |proxyDN|The DN of the user to connect as|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |proxyPass|The password of the remote directory|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |type|One of "ldap","dsmlv2" or "spml"|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |spmlImpl|When using SPML, the class name for the com.novell.ldap.spml.SPMLImpl interface|
*---------------------+-------------------------------------------------------+--------------------------------------+

  
* Master Replica Router

 The Master Replica Router is an insert that should be added to the global chain when you wish to seperate write operations from search operations, such as when utilizing MyVD in a master/replica environment.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.routing.MasterReplicaRouter|                                    |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Add, Modify, Rename, Delete, Compare, Search, Bind, Extended Operiations|                     |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|specifyToInclude|true or false, if the servers included by the readOnly option specifies the namespaces to be read only or those NOT to be considered read only.
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |readOnly|The names of namespaces configured that will be used for search operations|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |master|The nams of a namespace used to write operations|
*---------------------+-------------------------------------------------------+--------------------------------------+

* NTLM Authenticator
 
 The kerberos authenticator can be used to authenticate users via the Kerberos protocol, such as against LDAP.  Note that all configuration is based on the Java JNDI kerberos authentication file. (need to add a link)

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.jcifs.NTLMAuthenticator
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Bind                                                   |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|host                                                   |The host of the NTLM server (AD or an NTLM file share)|
*---------------------+-------------------------------------------------------+--------------------------------------+

* Password Change Operation

 This insert is an example of how an extended operation could be implemented in MyVD.  The insert deconstructs the operation in order to make sure that the request is routed properly.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.extensions.PasswordChangeOperation
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Extended Operation                                     |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|remoteBase|The final base of the operation|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |localBase|The base to expect in the operation|
*---------------------+-------------------------------------------------------+--------------------------------------+

* RootDSE Insert

 This insert should be placed in a namespace with an empty "nameSpace" property in order to construct a root dse object.

*---------------------+-------------------------------------------------------+--------------------------------------+
|Class Name           |net.sourceforge.myvd.inserts.RootDSE                   |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Scope                |Search                                     |                                      |
*---------------------+-------------------------------------------------------+--------------------------------------+
|Configuration Options|supportedFeatures|Comma seperated list|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |namingContexts|Pipe "\|" seperated list of DNs|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |supportedControls|Comma seperated list|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |supportedSaslMechanisms|Comma seperated list|
*---------------------+-------------------------------------------------------+--------------------------------------+
|                     |supportedExtensions|Comma seperated list|
*---------------------+-------------------------------------------------------+--------------------------------------+
